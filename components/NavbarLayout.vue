<template>
  <div>
    <header class="w-full py-2 px-10 flex items-center justify-between">
      <svg
        class="size-16 md:size-36"
        width="315"
        height="70"
        viewBox="0 0 315 70"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M28.528 69.96C22.256 69.96 16.88 68.84 12.4 66.6C7.984 64.296 4.176 60.968 0.976 56.616L10 46.44C13.136 50.792 16.24 53.768 19.312 55.368C22.448 56.904 25.808 57.672 29.392 57.672C31.376 57.672 33.136 57.384 34.672 56.808C36.272 56.232 37.52 55.432 38.416 54.408C39.376 53.384 39.856 52.2 39.856 50.856C39.856 49.832 39.632 48.904 39.184 48.072C38.736 47.176 38.096 46.408 37.264 45.768C36.432 45.064 35.44 44.456 34.288 43.944C33.136 43.368 31.856 42.888 30.448 42.504C29.04 42.12 27.504 41.768 25.84 41.448C22.256 40.68 19.12 39.688 16.432 38.472C13.744 37.256 11.504 35.784 9.712 34.056C7.92 32.328 6.576 30.344 5.68 28.104C4.848 25.8 4.432 23.24 4.432 20.424C4.432 16.456 5.552 13 7.792 10.056C10.032 7.048 13.008 4.712 16.72 3.048C20.432 1.32 24.528 0.455996 29.008 0.455996C35.088 0.455996 40.08 1.48 43.984 3.528C47.952 5.576 51.12 8.456 53.488 12.168L44.272 21.192C42.288 18.44 40.016 16.36 37.456 14.952C34.896 13.544 32.144 12.84 29.2 12.84C27.152 12.84 25.328 13.128 23.728 13.704C22.192 14.216 21.008 15.016 20.176 16.104C19.344 17.128 18.928 18.344 18.928 19.752C18.928 20.904 19.216 21.928 19.792 22.824C20.368 23.72 21.168 24.52 22.192 25.224C23.28 25.864 24.592 26.44 26.128 26.952C27.664 27.464 29.36 27.88 31.216 28.2C34.736 28.904 37.904 29.864 40.72 31.08C43.536 32.232 45.936 33.64 47.92 35.304C49.968 36.968 51.536 38.888 52.624 41.064C53.712 43.24 54.256 45.672 54.256 48.36C54.256 52.904 53.168 56.776 50.992 59.976C48.816 63.176 45.808 65.64 41.968 67.368C38.128 69.096 33.648 69.96 28.528 69.96ZM93.6985 69.96C88.7705 69.96 84.1945 69.096 79.9705 67.368C75.8105 65.64 72.1945 63.24 69.1225 60.168C66.1145 57.032 63.7465 53.352 62.0185 49.128C60.3545 44.904 59.5225 40.264 59.5225 35.208C59.5225 30.216 60.3545 25.608 62.0185 21.384C63.7465 17.16 66.1145 13.48 69.1225 10.344C72.1945 7.208 75.8105 4.776 79.9705 3.048C84.1945 1.32 88.7705 0.455996 93.6985 0.455996C98.6265 0.455996 103.139 1.32 107.235 3.048C111.395 4.776 115.011 7.208 118.083 10.344C121.155 13.48 123.523 17.16 125.187 21.384C126.915 25.608 127.779 30.248 127.779 35.304C127.779 40.232 126.915 44.808 125.187 49.032C123.523 53.256 121.155 56.936 118.083 60.072C115.011 63.208 111.395 65.64 107.235 67.368C103.139 69.096 98.6265 69.96 93.6985 69.96ZM93.6985 56.328C96.5145 56.328 99.1065 55.816 101.475 54.792C103.843 53.704 105.891 52.232 107.618 50.376C109.41 48.456 110.787 46.216 111.747 43.656C112.707 41.096 113.187 38.312 113.187 35.304C113.187 32.232 112.707 29.416 111.747 26.856C110.787 24.296 109.41 22.056 107.618 20.136C105.891 18.216 103.843 16.744 101.475 15.72C99.1065 14.632 96.5145 14.088 93.6985 14.088C90.8825 14.088 88.2585 14.632 85.8265 15.72C83.4585 16.744 81.3785 18.216 79.5865 20.136C77.8585 21.992 76.5145 24.232 75.5545 26.856C74.5945 29.416 74.1145 32.232 74.1145 35.304C74.1145 39.336 74.9465 42.952 76.6105 46.152C78.3385 49.288 80.6745 51.784 83.6185 53.64C86.5625 55.432 89.9225 56.328 93.6985 56.328ZM159.246 69.96C152.974 69.96 147.597 68.84 143.117 66.6C138.701 64.296 134.893 60.968 131.693 56.616L140.717 46.44C143.853 50.792 146.957 53.768 150.03 55.368C153.166 56.904 156.526 57.672 160.11 57.672C162.094 57.672 163.854 57.384 165.39 56.808C166.99 56.232 168.238 55.432 169.134 54.408C170.094 53.384 170.574 52.2 170.574 50.856C170.574 49.832 170.35 48.904 169.902 48.072C169.454 47.176 168.814 46.408 167.981 45.768C167.15 45.064 166.158 44.456 165.006 43.944C163.854 43.368 162.574 42.888 161.166 42.504C159.758 42.12 158.222 41.768 156.558 41.448C152.974 40.68 149.837 39.688 147.149 38.472C144.461 37.256 142.221 35.784 140.429 34.056C138.637 32.328 137.293 30.344 136.397 28.104C135.565 25.8 135.149 23.24 135.149 20.424C135.149 16.456 136.269 13 138.509 10.056C140.749 7.048 143.725 4.712 147.437 3.048C151.15 1.32 155.246 0.455996 159.726 0.455996C165.806 0.455996 170.798 1.48 174.702 3.528C178.67 5.576 181.837 8.456 184.205 12.168L174.99 21.192C173.006 18.44 170.734 16.36 168.174 14.952C165.614 13.544 162.862 12.84 159.918 12.84C157.87 12.84 156.045 13.128 154.445 13.704C152.91 14.216 151.726 15.016 150.893 16.104C150.061 17.128 149.645 18.344 149.645 19.752C149.645 20.904 149.933 21.928 150.51 22.824C151.086 23.72 151.885 24.52 152.909 25.224C153.998 25.864 155.31 26.44 156.845 26.952C158.381 27.464 160.077 27.88 161.934 28.2C165.454 28.904 168.622 29.864 171.438 31.08C174.254 32.232 176.654 33.64 178.638 35.304C180.686 36.968 182.254 38.888 183.341 41.064C184.43 43.24 184.974 45.672 184.974 48.36C184.974 52.904 183.886 56.776 181.71 59.976C179.534 63.176 176.526 65.64 172.686 67.368C168.846 69.096 164.366 69.96 159.246 69.96ZM224.032 69.96C219.104 69.96 214.56 69.128 210.4 67.464C206.304 65.736 202.72 63.336 199.648 60.264C196.64 57.128 194.304 53.448 192.64 49.224C191.04 45 190.24 40.36 190.24 35.304C190.24 30.376 191.104 25.832 192.832 21.672C194.56 17.448 196.992 13.768 200.128 10.632C203.264 7.496 206.912 5.064 211.072 3.336C215.296 1.608 219.872 0.743998 224.8 0.743998C228 0.743998 231.136 1.192 234.208 2.088C237.344 2.92 240.192 4.2 242.752 5.928C245.376 7.592 247.616 9.544 249.472 11.784L240.448 21.864C238.208 19.432 235.776 17.576 233.152 16.296C230.528 15.016 227.712 14.376 224.704 14.376C221.952 14.376 219.36 14.888 216.928 15.912C214.56 16.872 212.48 18.28 210.688 20.136C208.896 21.992 207.488 24.2 206.464 26.76C205.44 29.32 204.928 32.168 204.928 35.304C204.928 38.504 205.408 41.416 206.368 44.04C207.392 46.6 208.832 48.808 210.688 50.664C212.544 52.456 214.752 53.864 217.312 54.888C219.936 55.848 222.816 56.328 225.952 56.328C228 56.328 229.952 56.04 231.808 55.464C233.728 54.888 235.52 54.088 237.184 53.064C238.848 52.04 240.32 50.856 241.6 49.512L248.608 60.744C247.136 62.472 245.088 64.04 242.464 65.448C239.84 66.856 236.928 67.976 233.728 68.808C230.528 69.576 227.296 69.96 224.032 69.96ZM275.054 69V35.496L275.726 40.2L248.558 1.8H265.07L285.806 31.464L279.374 31.176L297.998 1.8H314.03L288.014 41.256L289.454 34.632V69H275.054Z"
          fill="white"
        />
      </svg>

      <UPopover v-if="user" :popper="{ placement: 'bottom-start' }">
        <span class="text-[clamp(0.5rem,1vw+0.5rem,1rem)]"
          >Hi, {{ user.user_metadata.name }} ðŸ‘‹</span
        >

        <template #panel>
          <button
            @click="
              toast.add({
                title: `Logging Out, Bye ${user.user_metadata.name} ðŸ‘‹`,
                timeout: 2000,
                callback: logOut,
              })
            "
            class="px-3 py-2 w-full flex items-start bg-black"
          >
            Log out from here
          </button>
        </template>
      </UPopover>
      <UButton
        v-else
        size="xl"
        color="black"
        variant="solid"
        @click="loginWithSpotify()"
      >
        <UIcon name="i-logos-spotify-icon" dynamic />
        Login in with spotify
      </UButton>
    </header>
  </div>
</template>

<script setup lang="ts">
const supabase = useSupabaseClient();
const user = useSupabaseUser();
const toast = useToast();

async function loginWithSpotify() {
  await supabase.auth.signInWithOAuth({
    provider: "spotify",
    options: {
      scopes: "user-top-read",
      redirectTo: "http://localhost:3000/callback",
    },
  });
}

async function logOut() {
  await supabase.auth.signOut();
}
</script>
